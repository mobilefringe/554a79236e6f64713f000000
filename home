<link href="/home.css" type="text/css" rel="stylesheet" />

<div class="content_container">
    <div class="right_nav hidden-phone">
        <!--<div class="home_hours">-->
        <!--    <h4 class="home_hours_heading">Hours</h4>-->
        <!--    <table role="presentation">-->
        <!--        <tr>-->
        <!--            <td class="hours_day">-->
        <!--                Monday to Friday-->
        <!--            </td>-->
        <!--            <td id="monday_home_container" class="text-right">-->
        <!--                <script id="monday_home_template" type="x-tmpl-mustache/text">-->
        <!--                    {{h}}-->
        <!--                </script>-->
        <!--            </td>-->
        <!--        </tr>-->
        <!--        <tr>-->
        <!--            <td class="hours_day">-->
        <!--                Saturday-->
        <!--            </td>-->
        <!--            <td id="saturday_home_container" class="text-right">-->
        <!--                <script id="saturday_home_template" type="x-tmpl-mustache/text">-->
        <!--                    {{h}}-->
        <!--                </script>-->
        <!--            </td>-->
        <!--        </tr>-->
        <!--        <tr>-->
        <!--            <td class="hours_day">-->
        <!--                Sunday-->
        <!--            </td>-->
        <!--            <td id="sunday_home_container" class="text-right">-->
        <!--                <script id="sunday_home_template" type="x-tmpl-mustache/text">-->
        <!--                    {{h}}-->
        <!--                </script>-->
        <!--            </td>-->
        <!--        </tr>-->
        <!--    </table>-->
        <!--</div>-->
        
        <!--<div class="home_store_directory">-->
        <!--    <a href="/map" class="home_map_">-->
        <!--        <h4 class="home_store_directory_heading">Map & Store Directory</h4>-->
        <!--        <img src="//codecloud.cdn.speedyrails.net/sites/554a79236e6f64713f000000/d9909884fde9cde52617add4032a7023/map_icon.png" class="pull-right" alt="map">-->
        <!--    </a>-->
        <!--</div>-->
    </div>
    <div class="visible-phone">
        <div class="mobile_hours">
            <span class="label_sub mobile_hours_label">TODAYS HOURS</span>
            
            <span class="label_sub mobile_hours_day" id="todays-hours">
                <script id="todays_hours_template" type="x-tmpl-mustache">
                    <li>{{day_name}}</li>                                          
                    <li style="font-weight:400; {{is_open_css}}"> {{val.h}} - {{close_time_localized}}</li>
                    <li style="font-weight:400; {{is_closed_css}}"> Closed</li>
                </script>
            </span>
        </div>
        <div class="directory_link"><a href="/stores">Map &amp; Store Directory</a></div>
    </div>
    <div id="main_flexslider" class="flexslider">
    <!--<ul class="slides">-->
        
    <!--    <li><img src="//codecloud.cdn.speedyrails.net/sites/554a79236e6f64713f000000/9816b71a53fd56cf2ba69dfaa33e09a2/home_img2.jpg" class="" alt=""></li>-->
    <!--</ul>-->
    <ul class="slides" id="home_banner">
        <script id="banner_template" type="x-tmpl-mustache/text">
            <li class="item">
                <a href="{{url}}" {{css}} onclick="{{noLink}}">
                    <img src="{{image_url}}"/>
                </a>
            </li>
        </script>
    </ul>
 </div>
    <div class="feature_box">
        <div id="feature_items">
            <script id="feature_template" type="x-tmpl-mustache/text">
                <div class="feature_item">
                    <a class="main_link" href="{{url}}">
                        <img class="feature_item_img" src="{{image_url}}" />
                        <div class="feature_item_description">
                            <p>{{name}}<span class="feature_caret fa fa-caret-right"></span></p>
                        </div>
                    </a>
                </div>
            </script>
        </div>
        <div class="feature_item" id="feature_promo">
            <script id="feature_promo_template" type="x-tmpl-mustache/text">
                <a href="{{url}}"><img class="store_logo" src="{{store_logo}}" /></a>
                <p class="feature_promo_name">
                    {{name_shortened}}
                    <br />
                    </p>
                <div class="feature_item_description">
                    <p><a href="/promotions/{{slug}}">Read More<span class="feature_caret fa fa-caret-right"></span></a></p>
                </div>
            </script>
        </div>
        <div class="clearfix"></div>
    </div>
</div>
<script>
    
    $(document).ready(function() {
        // $('#collapse_shopping').collapse('toggle')
        init();
        function renderPageData (){
            init_hours();
            var all_promos = [];
            var hours = getPropertyHours();
            $.each( getPromotionsList().reverse() , function( key, val ){
                // today = new Date();
                // webDate = new Date(val.show_on_web_date);
                today = moment();
                webDate = moment(val.show_on_web_date);
                if (today >= webDate) {
                    all_promos.push(val);
                } 
            });
            var latest_store_event = all_promos[0];
            var latest_mall_event = getPropertyEventsList().reverse()[0];
            if (latest_mall_event){
                renderSideEvents('#latest_mall_event_container', '#latest_mall_event_template', latest_mall_event, 'event');
            }
            if (latest_store_event){
                renderSideEvents('#latest_store_event_container', '#latest_store_event_template', latest_store_event, 'promo');
            } 
            var featureList = getFeatureList();
            renderFeatureItems('#feature_template', '#feature_items', featureList)
            var banners = getBanners()
            console.log(banners)
            renderBanner('#banner_template','#home_banner',banners);
            
            var monday_hours = getRegHoursForDayIndex(1);
            var saturday_hours = getRegHoursForDayIndex(6);
            var sunday_hours = getRegHoursForDayIndex(0);
            renderSideEvents('#feature_promo', '#feature_promo_template', latest_store_event, 'promo');
            renderLayoutHours('#monday_home_container', '#monday_home_template', monday_hours);
            renderLayoutHours('#saturday_home_container', '#saturday_home_template', saturday_hours);
            renderLayoutHours('#sunday_home_container', '#sunday_home_template', sunday_hours);
            renderTodaysHours('#todays_hours_template','#todays-hours');
                var open_time_localized = moment(val.open_time).tz(getPropertyTimeZone());
                var close_time = moment(val.close_time).tz(getPropertyTimeZone());
                // val.hour = open_time.format("h:mma") + " - " + close_time.format("h:mma");
                
            $('.flexslider').flexslider({
                animation: "slide",
                controlNav: false,
                directionNav: false,    
                animationLoop: true,
                slideshow: true
            })
        }
        
        function renderFeatureItems(feature_template,feature_items,featureList){
            var item_list = [];
            var item_rendered = [];
            var feature_template_html = $(feature_template).html();
            Mustache.parse(feature_template_html);   // optional, speeds up future uses
            count = 0
            $.each( featureList , function( key, val ) {
                if (count < 2){
                val.alt_url = val.image_url;
                var featureitem_rendered = Mustache.render(feature_template_html,val);
                item_rendered.push(featureitem_rendered);
                count = count + 1    
                }
               
            });
            
           
            $(feature_items).show();
            $(feature_items).html(item_rendered.join(''));
            $(".modal-backdrop").remove();
            
        }
        function renderTodaysHours(container, template, collection, type){
            var item_list = [];
            var item_rendered = [];
            var template_html = $(template).html();
            Mustache.parse(todays_hours_template);   // optional, speeds up future uses
            if (type == "property_details"){
                item_list.push(collection);
                collection = []
                collection = item_list;
            }
            if (type == "reg_hours") {
                $.each( collection , function( key, val ) {
                    if (!val.store_id && val.is_holiday == false) {
                        switch(val.day_of_week) {
                        case 0:
                            val.day = "Sunday"
                            break;
                        case 1:
                            val.day = "Monday"
                            break;
                        case 2:
                            val.day = "Tuesday"
                            break;
                        case 3:
                            val.day = "Wednesday"
                            break;
                        case 4:
                            val.day = "Thursday"
                            break;
                        case 5:
                            val.day = "Friday"
                            break;
                        case 6:
                            val.day = "Saturday"
                            break;
                    }
                    if (val.open_time && val.close_time && val.is_closed == false){
                        // var open_time = new Date (val.open_time)
                        // var close_time = new Date (val.close_time)
                        // val.open_time = convert_hour(open_time);
                        // val.close_time = convert_hour(close_time);    
                        // val.h = val.open_time+ " - " + val.close_time;
                        
                        var open_time = moment(val.open_time).tz(getPropertyTimeZone());
                        var close_time = moment(val.close_time).tz(getPropertyTimeZone());
                        val.h = open_time.format("h:mma") + " - " + close_time.format("h:mma");
                    } else {
                        "Closed"
                    }
                        item_list.push(val)
                    }
                });
                collection = []
                collection = item_list;
            }
        }    
        loadMallDataCached(renderPageData);
    })
</script>